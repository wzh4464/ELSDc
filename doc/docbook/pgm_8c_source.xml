<?xml version='1.0' encoding='UTF-8' standalone='no'?>
<section xmlns="http://docbook.org/ns/docbook" version="5.0" xmlns:xlink="http://www.w3.org/1999/xlink" xml:id="_pgm_8c_source" xml:lang="en-US">
<title>pgm.c</title>
<indexterm><primary>src/pgm.c</primary></indexterm>
Go to the documentation of this file.<programlisting linenumbering="unnumbered"><anchor xml:id="_pgm_8c_source_1l00001"/>00001 <emphasis role="comment">/*------------------------------------------------------------------------------</emphasis>
<anchor xml:id="_pgm_8c_source_1l00002"/>00002 <emphasis role="comment">&#32;&#32;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00003"/>00003 <emphasis role="comment">&#32;&#32;Copyright&#32;(c)&#32;2007-2011&#32;rafael&#32;grompone&#32;von&#32;gioi&#32;(grompone@gmail.com)&#32;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00004"/>00004 <emphasis role="comment">&#32;&#32;Copyright&#32;(c)&#32;2012-2014&#32;viorica&#32;patraucean&#32;(vpatrauc@gmail.com)</emphasis>
<anchor xml:id="_pgm_8c_source_1l00005"/>00005 <emphasis role="comment">&#32;&#32;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00006"/>00006 <emphasis role="comment">&#32;&#32;This&#32;program&#32;is&#32;free&#32;software:&#32;you&#32;can&#32;redistribute&#32;it&#32;and/or&#32;modify</emphasis>
<anchor xml:id="_pgm_8c_source_1l00007"/>00007 <emphasis role="comment">&#32;&#32;it&#32;under&#32;the&#32;terms&#32;of&#32;the&#32;GNU&#32;Affero&#32;General&#32;Public&#32;License&#32;as</emphasis>
<anchor xml:id="_pgm_8c_source_1l00008"/>00008 <emphasis role="comment">&#32;&#32;published&#32;by&#32;the&#32;Free&#32;Software&#32;Foundation,&#32;either&#32;version&#32;3&#32;of&#32;the</emphasis>
<anchor xml:id="_pgm_8c_source_1l00009"/>00009 <emphasis role="comment">&#32;&#32;License,&#32;or&#32;(at&#32;your&#32;option)&#32;any&#32;later&#32;version.</emphasis>
<anchor xml:id="_pgm_8c_source_1l00010"/>00010 <emphasis role="comment"></emphasis>
<anchor xml:id="_pgm_8c_source_1l00011"/>00011 <emphasis role="comment">&#32;&#32;This&#32;program&#32;is&#32;distributed&#32;in&#32;the&#32;hope&#32;that&#32;it&#32;will&#32;be&#32;useful,</emphasis>
<anchor xml:id="_pgm_8c_source_1l00012"/>00012 <emphasis role="comment">&#32;&#32;but&#32;WITHOUT&#32;ANY&#32;WARRANTY;&#32;without&#32;even&#32;the&#32;implied&#32;warranty&#32;of</emphasis>
<anchor xml:id="_pgm_8c_source_1l00013"/>00013 <emphasis role="comment">&#32;&#32;MERCHANTABILITY&#32;or&#32;FITNESS&#32;FOR&#32;A&#32;PARTICULAR&#32;PURPOSE.&#32;See&#32;the</emphasis>
<anchor xml:id="_pgm_8c_source_1l00014"/>00014 <emphasis role="comment">&#32;&#32;GNU&#32;Affero&#32;General&#32;Public&#32;License&#32;for&#32;more&#32;details.</emphasis>
<anchor xml:id="_pgm_8c_source_1l00015"/>00015 <emphasis role="comment"></emphasis>
<anchor xml:id="_pgm_8c_source_1l00016"/>00016 <emphasis role="comment">&#32;&#32;You&#32;should&#32;have&#32;received&#32;a&#32;copy&#32;of&#32;the&#32;GNU&#32;Affero&#32;General&#32;Public&#32;License</emphasis>
<anchor xml:id="_pgm_8c_source_1l00017"/>00017 <emphasis role="comment">&#32;&#32;along&#32;with&#32;this&#32;program.&#32;If&#32;not,&#32;see&#32;&lt;http://www.gnu.org/licenses/&gt;.</emphasis>
<anchor xml:id="_pgm_8c_source_1l00018"/>00018 <emphasis role="comment"></emphasis>
<anchor xml:id="_pgm_8c_source_1l00019"/>00019 <emphasis role="comment">&#32;&#32;pgm.c&#32;-&#32;This&#32;file&#32;belongs&#32;to&#32;ELSDc&#32;project&#32;(Ellipse&#32;and&#32;Line&#32;Segment&#32;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00020"/>00020 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;Detector&#32;with&#32;continuous&#32;validation).</emphasis>
<anchor xml:id="_pgm_8c_source_1l00021"/>00021 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;-&#32;It&#32;contains&#32;functions&#32;to&#32;read&#32;and&#32;write&#32;pgm&#32;images,&#32;and&#32;static&#32;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00022"/>00022 <emphasis role="comment">&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;functions&#32;called&#32;by&#32;these&#32;to&#32;read&#32;characters&#32;and&#32;numbers&#32;from&#32;a&#32;file.</emphasis>
<anchor xml:id="_pgm_8c_source_1l00023"/>00023 <emphasis role="comment"></emphasis>
<anchor xml:id="_pgm_8c_source_1l00024"/>00024 <emphasis role="comment">------------------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00025"/>00025 
<anchor xml:id="_pgm_8c_source_1l00026"/>00026 
<anchor xml:id="_pgm_8c_source_1l00027"/>00027 <emphasis role="preprocessor">#include&#32;&lt;stdio.h&gt;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00028"/>00028 <emphasis role="preprocessor">#include&#32;&lt;string.h&gt;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00029"/>00029 <emphasis role="preprocessor">#include&#32;&lt;stdlib.h&gt;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00030"/>00030 <emphasis role="preprocessor">#include&#32;&lt;float.h&gt;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00031"/>00031 <emphasis role="preprocessor">#include&#32;&lt;ctype.h&gt;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00032"/>00032 <emphasis role="preprocessor">#include&#32;&lt;time.h&gt;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00033"/>00033 <emphasis role="preprocessor">#include&#32;&lt;limits.h&gt;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00034"/>00034 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_misc_8h">misc.h</link>&quot;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00035"/>00035 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_image_8h">image.h</link>&quot;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00036"/>00036 <emphasis role="preprocessor">#include&#32;&quot;<link linkend="_pgm_8h">pgm.h</link>&quot;</emphasis>
<anchor xml:id="_pgm_8c_source_1l00037"/>00037 
<anchor xml:id="_pgm_8c_source_1l00038"/>00038 
<anchor xml:id="_pgm_8c_source_1l00039"/>00039 <emphasis role="comment">/*----------------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00042"/>00042 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">void</emphasis>&#32;skip_whites_and_comments(&#32;FILE&#32;*f&#32;)
<anchor xml:id="_pgm_8c_source_1l00043"/>00043 {
<anchor xml:id="_pgm_8c_source_1l00044"/>00044 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;c;
<anchor xml:id="_pgm_8c_source_1l00045"/>00045 &#32;&#32;<emphasis role="keywordflow">do</emphasis>
<anchor xml:id="_pgm_8c_source_1l00046"/>00046 &#32;&#32;&#32;&#32;{
<anchor xml:id="_pgm_8c_source_1l00047"/>00047 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>(&#32;isspace(&#32;c&#32;=&#32;getc(f)&#32;)&#32;);&#32;<emphasis role="comment">/*&#32;skip&#32;spaces&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00048"/>00048 &#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;c&#32;==&#32;<emphasis role="charliteral">&apos;#&apos;</emphasis>)&#32;<emphasis role="comment">/*&#32;skip&#32;comments&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00049"/>00049 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">while</emphasis>(&#32;(c&#32;!=&#32;<emphasis role="charliteral">&apos;\n&apos;</emphasis>)&#32;&amp;&amp;&#32;(c&#32;!=&#32;<emphasis role="charliteral">&apos;\r&apos;</emphasis>)&#32;&amp;&amp;&#32;(c&#32;!=&#32;EOF)&#32;)
<anchor xml:id="_pgm_8c_source_1l00050"/>00050 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;c&#32;=&#32;getc(f);
<anchor xml:id="_pgm_8c_source_1l00051"/>00051 &#32;&#32;&#32;&#32;}
<anchor xml:id="_pgm_8c_source_1l00052"/>00052 
<anchor xml:id="_pgm_8c_source_1l00053"/>00053 &#32;&#32;<emphasis role="keywordflow">while</emphasis>(&#32;(c&#32;==&#32;<emphasis role="charliteral">&apos;#&apos;</emphasis>)&#32;||&#32;(isspace(c))&#32;);
<anchor xml:id="_pgm_8c_source_1l00054"/>00054 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;(c&#32;!=&#32;EOF)&#32;&amp;&amp;&#32;(ungetc(&#32;c,&#32;f&#32;)&#32;==&#32;EOF)&#32;)
<anchor xml:id="_pgm_8c_source_1l00055"/>00055 &#32;&#32;&#32;&#32;<link linkend="_misc_8c_1aad9796c174f7ef5d226cd169f2520fd5">error</link>(<emphasis role="stringliteral">&quot;skip_whites_and_comments:&#32;unable&#32;to&#32;&apos;ungetc&apos;&#32;in&#32;reading&#32;PGM&#32;file.&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00056"/>00056 }
<anchor xml:id="_pgm_8c_source_1l00057"/>00057 
<anchor xml:id="_pgm_8c_source_1l00058"/>00058 
<anchor xml:id="_pgm_8c_source_1l00059"/>00059 <emphasis role="comment">/*----------------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00062"/>00062 <emphasis role="keyword">static</emphasis>&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;get_num(&#32;FILE&#32;*f&#32;)
<anchor xml:id="_pgm_8c_source_1l00063"/>00063 {
<anchor xml:id="_pgm_8c_source_1l00064"/>00064 &#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;num;
<anchor xml:id="_pgm_8c_source_1l00065"/>00065 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;c;
<anchor xml:id="_pgm_8c_source_1l00066"/>00066 
<anchor xml:id="_pgm_8c_source_1l00067"/>00067 &#32;&#32;<emphasis role="keywordflow">while</emphasis>(&#32;isspace(&#32;c&#32;=&#32;getc(f)&#32;)&#32;);&#32;<emphasis role="comment">/*&#32;skip&#32;spaces&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00068"/>00068 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;!isdigit(c)&#32;)&#32;<link linkend="_misc_8c_1aad9796c174f7ef5d226cd169f2520fd5">error</link>(<emphasis role="stringliteral">&quot;Error:&#32;corrupted&#32;PGM&#32;file.&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00069"/>00069 
<anchor xml:id="_pgm_8c_source_1l00070"/>00070 &#32;&#32;num&#32;=&#32;(<emphasis role="keywordtype">unsigned</emphasis>&#32;int)&#32;(c&#32;-&#32;<emphasis role="charliteral">&apos;0&apos;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00071"/>00071 &#32;&#32;<emphasis role="keywordflow">while</emphasis>(&#32;isdigit(&#32;c&#32;=&#32;getc(f)&#32;)&#32;)&#32;num&#32;=&#32;10&#32;*&#32;num&#32;+&#32;c&#32;-&#32;<emphasis role="charliteral">&apos;0&apos;</emphasis>;
<anchor xml:id="_pgm_8c_source_1l00072"/>00072 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;(c&#32;!=&#32;EOF)&#32;&amp;&amp;&#32;(ungetc(&#32;c,&#32;f&#32;)&#32;==&#32;EOF)&#32;)
<anchor xml:id="_pgm_8c_source_1l00073"/>00073 &#32;&#32;&#32;&#32;<link linkend="_misc_8c_1aad9796c174f7ef5d226cd169f2520fd5">error</link>(<emphasis role="stringliteral">&quot;get_num:&#32;unable&#32;to&#32;&apos;ungetc&apos;&#32;while&#32;reading&#32;PGM&#32;file.&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00074"/>00074 
<anchor xml:id="_pgm_8c_source_1l00075"/>00075 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;num;
<anchor xml:id="_pgm_8c_source_1l00076"/>00076 }
<anchor xml:id="_pgm_8c_source_1l00077"/>00077 
<anchor xml:id="_pgm_8c_source_1l00078"/>00078 
<anchor xml:id="_pgm_8c_source_1l00079"/>00079 <emphasis role="comment">/*----------------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00083"/><link linkend="_pgm_8c_1a9a98683fcb23d861dc3b3ac2437267bb">00083</link> <link linkend="_structImageDouble">PImageDouble</link>&#32;<link linkend="_pgm_8c_1a9a98683fcb23d861dc3b3ac2437267bb">read_pgm_image_double</link>(&#32;<emphasis role="keywordtype">char</emphasis>&#32;*name&#32;)
<anchor xml:id="_pgm_8c_source_1l00084"/>00084 {
<anchor xml:id="_pgm_8c_source_1l00085"/>00085 &#32;&#32;FILE&#32;*f;
<anchor xml:id="_pgm_8c_source_1l00086"/>00086 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;c,&#32;bin&#32;=&#32;<link linkend="_misc_8h_1aa93f0eb578d23995850d61f7d61c55c1">FALSE</link>;
<anchor xml:id="_pgm_8c_source_1l00087"/>00087 &#32;&#32;<emphasis role="keywordtype">unsigned</emphasis>&#32;<emphasis role="keywordtype">int</emphasis>&#32;xsize,&#32;ysize,&#32;depth,&#32;x,&#32;y;
<anchor xml:id="_pgm_8c_source_1l00088"/>00088 &#32;&#32;<link linkend="_structImageDouble">PImageDouble</link>&#32;image;
<anchor xml:id="_pgm_8c_source_1l00089"/>00089 
<anchor xml:id="_pgm_8c_source_1l00090"/>00090 &#32;&#32;<emphasis role="comment">/*&#32;open&#32;file&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00091"/>00091 &#32;&#32;f&#32;=&#32;fopen(&#32;name,<emphasis role="stringliteral">&quot;rb&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00092"/>00092 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;f&#32;==&#32;NULL&#32;)&#32;
<anchor xml:id="_pgm_8c_source_1l00093"/>00093 &#32;&#32;&#32;&#32;<link linkend="_misc_8c_1aad9796c174f7ef5d226cd169f2520fd5">error</link>(<emphasis role="stringliteral">&quot;read_pgm_image_double:&#32;unable&#32;to&#32;open&#32;input&#32;image&#32;file.&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00094"/>00094 
<anchor xml:id="_pgm_8c_source_1l00095"/>00095 &#32;&#32;<emphasis role="comment">/*&#32;read&#32;header&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00096"/>00096 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;getc(f)&#32;!=&#32;<emphasis role="charliteral">&apos;P&apos;</emphasis>)&#32;<link linkend="_misc_8c_1aad9796c174f7ef5d226cd169f2520fd5">error</link>(<emphasis role="stringliteral">&quot;read_pgm_image_double:&#32;not&#32;a&#32;PGM&#32;file.&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00097"/>00097 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;(c&#32;=&#32;getc(f)&#32;)&#32;==&#32;<emphasis role="charliteral">&apos;2&apos;</emphasis>)&#32;bin&#32;=&#32;<link linkend="_misc_8h_1aa93f0eb578d23995850d61f7d61c55c1">FALSE</link>;
<anchor xml:id="_pgm_8c_source_1l00098"/>00098 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<emphasis role="keywordflow">if</emphasis>(&#32;c&#32;==&#32;<emphasis role="charliteral">&apos;5&apos;</emphasis>)&#32;bin&#32;=&#32;<link linkend="_misc_8h_1aa8cecfc5c5c054d2875c03e77b7be15d">TRUE</link>;
<anchor xml:id="_pgm_8c_source_1l00099"/>00099 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;<link linkend="_misc_8c_1aad9796c174f7ef5d226cd169f2520fd5">error</link>(<emphasis role="stringliteral">&quot;read_pgm_image_double:&#32;not&#32;a&#32;PGM&#32;file.&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00100"/>00100 
<anchor xml:id="_pgm_8c_source_1l00101"/>00101 &#32;&#32;skip_whites_and_comments(f);
<anchor xml:id="_pgm_8c_source_1l00102"/>00102 &#32;&#32;xsize&#32;=&#32;get_num(f);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;X&#32;size&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00103"/>00103 &#32;&#32;skip_whites_and_comments(f);
<anchor xml:id="_pgm_8c_source_1l00104"/>00104 &#32;&#32;ysize&#32;=&#32;get_num(f);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;Y&#32;size&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00105"/>00105 &#32;&#32;skip_whites_and_comments(f);
<anchor xml:id="_pgm_8c_source_1l00106"/>00106 &#32;&#32;depth&#32;=&#32;get_num(f);&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="comment">/*&#32;depth&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00107"/>00107 
<anchor xml:id="_pgm_8c_source_1l00108"/>00108 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;depth==0&#32;)&#32;
<anchor xml:id="_pgm_8c_source_1l00109"/>00109 &#32;&#32;&#32;&#32;fprintf(&#32;stderr,<emphasis role="stringliteral">&quot;Warning:&#32;depth=0,&#32;probably&#32;invalid&#32;PGM&#32;file.\n&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00110"/>00110 
<anchor xml:id="_pgm_8c_source_1l00111"/>00111 &#32;&#32;<emphasis role="comment">/*&#32;white&#32;before&#32;data&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00112"/>00112 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;!isspace(&#32;c&#32;=&#32;getc(f)&#32;)&#32;)&#32;
<anchor xml:id="_pgm_8c_source_1l00113"/>00113 &#32;&#32;&#32;&#32;<link linkend="_misc_8c_1aad9796c174f7ef5d226cd169f2520fd5">error</link>(<emphasis role="stringliteral">&quot;read_pgm_image_double:&#32;corrupted&#32;PGM&#32;file.&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00114"/>00114 
<anchor xml:id="_pgm_8c_source_1l00115"/>00115 &#32;&#32;<emphasis role="comment">/*&#32;get&#32;memory&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00116"/>00116 &#32;&#32;image&#32;=&#32;<link linkend="_image_8c_1a5baadc47eb068cd9e3b2d52a5065e3c0">new_PImageDouble</link>(&#32;xsize,&#32;ysize&#32;);
<anchor xml:id="_pgm_8c_source_1l00117"/>00117 &#32;&#32;
<anchor xml:id="_pgm_8c_source_1l00118"/>00118 &#32;&#32;<emphasis role="comment">/*&#32;read&#32;data&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00119"/>00119 &#32;&#32;<emphasis role="keywordflow">for</emphasis>(&#32;y=0;&#32;y&lt;ysize;&#32;y++)
<anchor xml:id="_pgm_8c_source_1l00120"/>00120 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>(&#32;x=0;&#32;x&lt;xsize;&#32;x++)
<anchor xml:id="_pgm_8c_source_1l00121"/>00121 &#32;&#32;&#32;&#32;&#32;&#32;image-&gt;<link linkend="_structImageDouble_1a23436a7a2b44939627b59df11be7ad75">data</link>[&#32;x&#32;+&#32;y&#32;*&#32;xsize&#32;]&#32;=&#32;bin&#32;?&#32;(<emphasis role="keywordtype">double</emphasis>)&#32;getc(f)
<anchor xml:id="_pgm_8c_source_1l00122"/>00122 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;:&#32;(double)&#32;get_num(f);
<anchor xml:id="_pgm_8c_source_1l00123"/>00123 
<anchor xml:id="_pgm_8c_source_1l00124"/>00124 &#32;&#32;<emphasis role="comment">/*&#32;close&#32;file&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00125"/>00125 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;(f&#32;!=&#32;stdin)&#32;&amp;&amp;&#32;(fclose(f)&#32;==&#32;EOF)&#32;)
<anchor xml:id="_pgm_8c_source_1l00126"/>00126 &#32;&#32;&#32;&#32;<link linkend="_misc_8c_1aad9796c174f7ef5d226cd169f2520fd5">error</link>(<emphasis role="stringliteral">&quot;read_pgm_image_double:&#32;unable&#32;to&#32;close&#32;file.&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00127"/>00127 &#32;&#32;
<anchor xml:id="_pgm_8c_source_1l00128"/>00128 &#32;&#32;<emphasis role="keywordflow">return</emphasis>&#32;image;
<anchor xml:id="_pgm_8c_source_1l00129"/>00129 }
<anchor xml:id="_pgm_8c_source_1l00130"/>00130 
<anchor xml:id="_pgm_8c_source_1l00131"/>00131 
<anchor xml:id="_pgm_8c_source_1l00132"/>00132 <emphasis role="comment">/*----------------------------------------------------------------------------*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00136"/><link linkend="_pgm_8c_1a94f252c634af4c81659315c4545be8b8">00136</link> <emphasis role="keywordtype">void</emphasis>&#32;<link linkend="_pgm_8c_1a94f252c634af4c81659315c4545be8b8">write_pgm_image_int</link>(&#32;<emphasis role="keywordtype">int</emphasis>&#32;*image,&#32;<emphasis role="keywordtype">int</emphasis>&#32;xsize,&#32;<emphasis role="keywordtype">int</emphasis>&#32;ysize,&#32;<emphasis role="keywordtype">char</emphasis>&#32;*name&#32;)
<anchor xml:id="_pgm_8c_source_1l00137"/>00137 {
<anchor xml:id="_pgm_8c_source_1l00138"/>00138 &#32;&#32;FILE&#32;*f;
<anchor xml:id="_pgm_8c_source_1l00139"/>00139 &#32;&#32;<emphasis role="keywordtype">int</emphasis>&#32;x,&#32;y,&#32;n,&#32;v,&#32;<link linkend="_misc_8h_1a24e753bacac6be5f30e18f8a2bdefda4">max</link>,&#32;<link linkend="_misc_8h_1a2d017cd3beb218080a7988e2deed2a11">min</link>;
<anchor xml:id="_pgm_8c_source_1l00140"/>00140 
<anchor xml:id="_pgm_8c_source_1l00141"/>00141 &#32;&#32;<emphasis role="comment">/*&#32;check&#32;input&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00142"/>00142 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;(image&#32;==&#32;NULL)&#32;||&#32;(xsize&#32;&lt;=&#32;0)&#32;||&#32;(ysize&#32;&lt;=&#32;0)&#32;)
<anchor xml:id="_pgm_8c_source_1l00143"/>00143 &#32;&#32;&#32;&#32;<link linkend="_misc_8c_1aad9796c174f7ef5d226cd169f2520fd5">error</link>(<emphasis role="stringliteral">&quot;write_pgm_image_int:&#32;invalid&#32;input&#32;image.&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00144"/>00144 
<anchor xml:id="_pgm_8c_source_1l00145"/>00145 &#32;&#32;<emphasis role="comment">/*&#32;check&#32;min&#32;and&#32;max&#32;values&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00146"/>00146 &#32;&#32;<link linkend="_misc_8h_1a24e753bacac6be5f30e18f8a2bdefda4">max</link>&#32;=&#32;<link linkend="_misc_8h_1a2d017cd3beb218080a7988e2deed2a11">min</link>&#32;=&#32;0;
<anchor xml:id="_pgm_8c_source_1l00147"/>00147 &#32;&#32;<emphasis role="keywordflow">for</emphasis>(&#32;y=0;&#32;y&lt;ysize;&#32;y++&#32;)
<anchor xml:id="_pgm_8c_source_1l00148"/>00148 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>(&#32;x=0;&#32;x&lt;xsize;&#32;x++&#32;)
<anchor xml:id="_pgm_8c_source_1l00149"/>00149 &#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_pgm_8c_source_1l00150"/>00150 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;v&#32;=&#32;image[&#32;x&#32;+&#32;y&#32;*&#32;xsize&#32;];
<anchor xml:id="_pgm_8c_source_1l00151"/>00151 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;v&#32;&gt;&#32;<link linkend="_misc_8h_1a24e753bacac6be5f30e18f8a2bdefda4">max</link>&#32;)&#32;<link linkend="_misc_8h_1a24e753bacac6be5f30e18f8a2bdefda4">max</link>&#32;=&#32;v;
<anchor xml:id="_pgm_8c_source_1l00152"/>00152 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;v&#32;&lt;&#32;<link linkend="_misc_8h_1a2d017cd3beb218080a7988e2deed2a11">min</link>&#32;)&#32;<link linkend="_misc_8h_1a2d017cd3beb218080a7988e2deed2a11">min</link>&#32;=&#32;v;
<anchor xml:id="_pgm_8c_source_1l00153"/>00153 &#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_pgm_8c_source_1l00154"/>00154 
<anchor xml:id="_pgm_8c_source_1l00155"/>00155 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;<link linkend="_misc_8h_1a2d017cd3beb218080a7988e2deed2a11">min</link>&#32;&lt;&#32;0&#32;)&#32;fprintf(&#32;stderr,
<anchor xml:id="_pgm_8c_source_1l00156"/>00156 &#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;Warning:&#32;write_pgm_image_int:&#32;negative&#32;values&#32;in&#32;&apos;%s&apos;.\n&quot;</emphasis>,&#32;name&#32;);
<anchor xml:id="_pgm_8c_source_1l00157"/>00157 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;<link linkend="_misc_8h_1a24e753bacac6be5f30e18f8a2bdefda4">max</link>&#32;&gt;&#32;65535&#32;)&#32;fprintf(&#32;stderr,
<anchor xml:id="_pgm_8c_source_1l00158"/>00158 &#32;&#32;&#32;&#32;<emphasis role="stringliteral">&quot;Warning:&#32;write_pgm_image_int:&#32;values&#32;exceeding&#32;65535&#32;in&#32;&apos;%s&apos;.\n&quot;</emphasis>,&#32;name&#32;);
<anchor xml:id="_pgm_8c_source_1l00159"/>00159 
<anchor xml:id="_pgm_8c_source_1l00160"/>00160 &#32;&#32;<emphasis role="comment">/*&#32;open&#32;file&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00161"/>00161 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;strcmp(&#32;name,<emphasis role="stringliteral">&quot;-&quot;</emphasis>)&#32;==&#32;0&#32;)&#32;f&#32;=&#32;stdout;
<anchor xml:id="_pgm_8c_source_1l00162"/>00162 &#32;&#32;<emphasis role="keywordflow">else</emphasis>&#32;f&#32;=&#32;fopen(&#32;name,<emphasis role="stringliteral">&quot;w&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00163"/>00163 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;f&#32;==&#32;NULL&#32;)&#32;
<anchor xml:id="_pgm_8c_source_1l00164"/>00164 &#32;&#32;&#32;&#32;<link linkend="_misc_8c_1aad9796c174f7ef5d226cd169f2520fd5">error</link>(<emphasis role="stringliteral">&quot;write_pgm_image_int:&#32;unable&#32;to&#32;open&#32;output&#32;image&#32;file.&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00165"/>00165 
<anchor xml:id="_pgm_8c_source_1l00166"/>00166 &#32;&#32;<emphasis role="comment">/*&#32;write&#32;header&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00167"/>00167 &#32;&#32;fprintf(&#32;f,<emphasis role="stringliteral">&quot;P2\n&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00168"/>00168 &#32;&#32;fprintf(&#32;f,<emphasis role="stringliteral">&quot;%d&#32;%d\n&quot;</emphasis>,&#32;xsize,&#32;ysize&#32;);
<anchor xml:id="_pgm_8c_source_1l00169"/>00169 &#32;&#32;fprintf(&#32;f,<emphasis role="stringliteral">&quot;%d\n&quot;</emphasis>,&#32;<link linkend="_misc_8h_1a24e753bacac6be5f30e18f8a2bdefda4">max</link>);
<anchor xml:id="_pgm_8c_source_1l00170"/>00170 
<anchor xml:id="_pgm_8c_source_1l00171"/>00171 &#32;&#32;<emphasis role="comment">/*&#32;write&#32;data&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00172"/>00172 &#32;&#32;<emphasis role="keywordflow">for</emphasis>(&#32;n=0,&#32;y=0;&#32;y&lt;ysize;&#32;y++&#32;)
<anchor xml:id="_pgm_8c_source_1l00173"/>00173 &#32;&#32;&#32;&#32;<emphasis role="keywordflow">for</emphasis>(&#32;x=0;&#32;x&lt;xsize;&#32;x++&#32;)
<anchor xml:id="_pgm_8c_source_1l00174"/>00174 &#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_pgm_8c_source_1l00175"/>00175 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fprintf(&#32;f,<emphasis role="stringliteral">&quot;%d&#32;&quot;</emphasis>,&#32;image[&#32;x&#32;+&#32;y&#32;*&#32;xsize&#32;]&#32;);
<anchor xml:id="_pgm_8c_source_1l00176"/>00176 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;++n&#32;==&#32;8&#32;)&#32;&#32;<emphasis role="comment">/*&#32;lines&#32;should&#32;not&#32;be&#32;longer&#32;than&#32;70&#32;characters&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00177"/>00177 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;{
<anchor xml:id="_pgm_8c_source_1l00178"/>00178 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;fprintf(&#32;f,<emphasis role="stringliteral">&quot;\n&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00179"/>00179 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;n&#32;=&#32;0;
<anchor xml:id="_pgm_8c_source_1l00180"/>00180 &#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_pgm_8c_source_1l00181"/>00181 &#32;&#32;&#32;&#32;&#32;&#32;}
<anchor xml:id="_pgm_8c_source_1l00182"/>00182 
<anchor xml:id="_pgm_8c_source_1l00183"/>00183 &#32;&#32;<emphasis role="comment">/*&#32;close&#32;file&#32;if&#32;needed&#32;*/</emphasis>
<anchor xml:id="_pgm_8c_source_1l00184"/>00184 &#32;&#32;<emphasis role="keywordflow">if</emphasis>(&#32;(f&#32;!=&#32;stdout)&#32;&amp;&amp;&#32;(fclose(f)&#32;==&#32;EOF)&#32;)
<anchor xml:id="_pgm_8c_source_1l00185"/>00185 &#32;&#32;&#32;&#32;<link linkend="_misc_8c_1aad9796c174f7ef5d226cd169f2520fd5">error</link>(<emphasis role="stringliteral">&quot;write_pgm_image_int:&#32;unable&#32;to&#32;close&#32;file.&quot;</emphasis>);
<anchor xml:id="_pgm_8c_source_1l00186"/>00186 }
</programlisting></section>
